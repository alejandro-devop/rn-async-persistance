{"version":3,"file":"index.js","sources":["../src/redux-session-provider/context.ts","../src/hooks/useSession.ts","../src/redux-session-provider/reducers/store.reducer.ts","../src/redux-session-provider/ReduxWrapper.tsx","../src/redux-session-provider/debugger/Debugger.tsx","../src/redux-session-provider/actions/store.actions.ts","../src/redux-session-provider/SessionDriver.tsx","../src/redux-session-provider/ReduxSessionProvider.tsx"],"sourcesContent":["import React from 'react'\n\nexport const SessionContext = React.createContext({})\n\nexport const SessionContextProvider = SessionContext.Provider\nexport const SessionContextConsumer = SessionContext.Consumer\n","import { useContext } from 'react'\n// import { SessionContext } from '../session-provider/Context'\nimport { SessionContext } from '../redux-session-provider/context'\n\nconst useSession = () => {\n    const { store, clear, removeKey, setAllKeys, setKey } = useContext(SessionContext) as any\n    return { store, clear, removeKey, setAllKeys, setKey }\n}\n\nexport default useSession\n","import { StoreKeyType } from '../types'\n\ntype ActionType = {\n    type: StoreKeyType\n    payload: {\n        key: string\n        data?: any\n    }\n}\n\nexport default (initialState?: any) =>\n    (state: any = initialState, action: ActionType) => {\n        const { type, payload } = action\n        const { key, data } = payload || {}\n        switch (type) {\n            case '@store/set-key':\n                return { ...state, [key]: data }\n            case '@store/del-key':\n                return { ...state, [key]: null }\n            case '@store/set-all':\n                return { ...state, ...payload }\n            default:\n                return state\n        }\n    }\n","import React from 'react'\nimport { Provider } from 'react-redux'\nimport { configureStore } from '@reduxjs/toolkit'\nimport { combineReducers } from 'redux'\nimport getReducer from './reducers/store.reducer'\nimport AsyncStorage from '@react-native-async-storage/async-storage'\n\nconst ReduxWrapper: React.FC<{ children: React.ReactNode; initialState?: any }> = ({\n    children,\n    initialState\n}) => {\n    const store = configureStore({ reducer: combineReducers({ store: getReducer(initialState) }) })\n    let timesControl: any = null\n    const onStateChanged = React.useCallback(async () => {\n        const newStore = store.getState()\n        try {\n            console.log('Updating the state.')\n            AsyncStorage.setItem('@store', JSON.stringify(newStore?.store))\n        } catch {}\n    }, [store])\n\n    store.subscribe(async () => {\n        clearTimeout(timesControl)\n        timesControl = setTimeout(() => {\n            onStateChanged()\n        }, 200)\n    })\n    React.useEffect(() => {\n        return () => {\n            clearTimeout(timesControl)\n        }\n    }, [timesControl])\n    return <Provider store={store}>{children}</Provider>\n}\n\nReduxWrapper.defaultProps = {\n    initialState: {\n        logged: false\n    }\n}\n\nexport default ReduxWrapper\n","import React from 'react'\nconst Debugger: React.FC = () => {\n    return <></>\n}\n\nexport default Debugger\n","import { StoreActionType } from '../types'\n\nexport const setKey: StoreActionType = (key: string, data: any) => ({\n    type: '@store/set-key',\n    payload: {\n        key,\n        data\n    }\n})\n\nexport const setAll: StoreActionType = (keys: any) => ({\n    type: '@store/set-all',\n    payload: keys\n})\n\nexport const removeKey: StoreActionType = (key: string) => ({\n    type: '@store/del-key',\n    payload: {\n        key\n    }\n})\n","import React from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { SessionContextProvider } from './context'\nimport * as actions from './actions/store.actions'\n\nconst SessionDriver: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n    const store = useSelector((state: any) => state.store)\n    const dispatch = useDispatch()\n    const handleSetKey = async (key: string, value: any) => {\n        dispatch(actions.setKey(key, value))\n    }\n    const handleRemoveKey = () => {}\n    const handleSetAllKeys = (keys: any) => {\n        dispatch(actions.setAll(keys))\n    }\n    const handleClear = () => {}\n\n    return (\n        <SessionContextProvider\n            value={{\n                store,\n                setKey: handleSetKey,\n                setAllKeys: handleSetAllKeys,\n                removeKey: handleRemoveKey,\n                clear: handleClear,\n                debug: false\n            }}\n        >\n            {children}\n        </SessionContextProvider>\n    )\n}\n\nexport default SessionDriver\n","import React from 'react'\nimport ReduxWrapper from './ReduxWrapper'\nimport Debugger from './debugger'\nimport SessionDriver from './SessionDriver'\nimport AsyncStorage from '@react-native-async-storage/async-storage'\n\n/**\n * Loads async storage and data and initializes the redux store\n * @param param0\n * @returns\n */\nconst ReduxSessionProvider: React.FC<{ children?: React.ReactNode }> = ({ children }) => {\n    //Load the session from the async storage\n    const [persistedData, setPersistedData] = React.useState({})\n    const [loaded, setLoaded] = React.useState(false)\n\n    const getData = React.useCallback(async () => {\n        const storedStore = await AsyncStorage.getItem('@store')\n        const parsedStore = JSON.parse(storedStore || '{}')\n        setPersistedData(parsedStore)\n        setLoaded(true)\n    }, [setPersistedData])\n\n    React.useEffect(() => {\n        if (!loaded) {\n            getData()\n        }\n    }, [loaded])\n\n    if (!loaded) {\n        return <></>\n    }\n    return (\n        <ReduxWrapper initialState={persistedData}>\n            <SessionDriver>\n                {children}\n                <Debugger />\n            </SessionDriver>\n        </ReduxWrapper>\n    )\n}\n\nexport default ReduxSessionProvider\n"],"names":["React","useContext","configureStore","combineReducers","AsyncStorage","Provider","useSelector","useDispatch","actions.setKey","actions.setAll"],"mappings":"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"}