{"version":3,"file":"index.js","sources":["../src/session-provider/Context.ts","../src/hooks/useSession.ts","../src/session-provider/Wrapper.tsx","../src/session-provider/debugger/Debugger.tsx","../src/hooks/usePrevProps.ts","../src/session-provider/SessionProvider.tsx"],"sourcesContent":["import React from 'react'\nimport { SessionContextType } from '../types/SessionContext'\nexport const SessionContext = React.createContext<SessionContextType>({\n    store: {},\n    setKey: () => null,\n    setAllKeys: () => null,\n    removeKey: () => null,\n    clear: () => null\n})\nexport const SessionContextProvider = SessionContext.Provider\nexport const SessionContextConsumer = SessionContext.Consumer\n","import { useContext } from 'react'\nimport { SessionContext } from '../session-provider/Context'\n\nconst useSession = () => {\n    const { store, clear, removeKey, setAllKeys, setKey } = useContext(SessionContext)\n    return { store, clear, removeKey, setAllKeys, setKey }\n}\n\nexport default useSession\n","import React from 'react'\n// import { View } from 'react-native'\n\nconst Wrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n    return <>{children}</>\n}\n\nexport default Wrapper\n","import React from 'react'\nimport { View, Text, StyleSheet } from 'react-native'\n\nconst Debugger: React.FC = () => {\n    return (\n        <View style={styles.root}>\n            <Text>Session debuger</Text>\n        </View>\n    )\n}\n\nconst styles = StyleSheet.create({\n    root: {\n        position: 'absolute',\n        bottom: 0,\n        width: '100%',\n        height: 300,\n        backgroundColor: 'rgba(255,255,255, 0.8)',\n        padding: 20\n    }\n})\n\nexport default Debugger\n","import React, { useRef } from 'react'\n\nconst usePrevProps = <ValueType extends unknown>(value: ValueType): ValueType | typeof value => {\n    const ref = useRef<ValueType>()\n    React.useEffect(() => {\n        ref.current = value\n    })\n    return (ref.current || {}) as any\n}\n\nexport default usePrevProps\n","import React from 'react'\nimport Wrapper from './Wrapper'\nimport Debugger from './debugger'\nimport { SessionContextProvider } from './Context'\nimport usePrevProps from '../hooks/usePrevProps'\nimport _ from 'lodash'\n\nconst SessionProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n    const [store, setStore] = React.useState({})\n    // const [locked, setLocked] = React.useState(false)\n    const queue = React.useRef<{ type: 'key' | 'all'; payload: any }[]>([])\n    const prevProps = usePrevProps({ store, queue: queue.current })\n    const processing = React.useRef<boolean>(false)\n    const setKey = (key: string, value: any) => {\n        queue.current.push({ type: 'key', payload: { key, value } })\n        if (!processing.current) {\n            processing.current = true\n            processQueue()\n        }\n    }\n\n    const processQueue = React.useCallback(() => {\n        const queueSize = queue.current.length\n        if (queueSize > 0) {\n            const storeToPersist = queue.current.reduce((newStore, currentItem) => {\n                if (currentItem.type === 'key') {\n                    const { payload } = currentItem\n                    newStore[payload.key] = payload.value\n                }\n                return newStore\n            }, store)\n            queue.current = []\n            if (_.isEqual(prevProps.store, store)) {\n            } else {\n                setStore({ ...store, ...storeToPersist })\n            }\n        }\n        processing.current = false\n    }, [store, queue.current, prevProps.store, processing.current])\n\n    React.useEffect(() => {\n        processQueue()\n    }, [queue.current, store])\n\n    const setAllKeys = () => {}\n    const removeKey = () => {}\n    const clear = () => {}\n\n    return (\n        <Wrapper>\n            <SessionContextProvider\n                value={{\n                    store,\n                    setKey,\n                    setAllKeys,\n                    removeKey,\n                    clear\n                }}\n            >\n                {children}\n                <Debugger />\n            </SessionContextProvider>\n        </Wrapper>\n    )\n}\n\nexport default SessionProvider\n"],"names":["React","useContext","View","Text","StyleSheet","useRef","_"],"mappings":"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"}